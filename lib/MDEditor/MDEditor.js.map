{"version":3,"sources":["../../src/MDEditor/MDEditor.jsx"],"names":[],"mappings":"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","file":"MDEditor.js","sourcesContent":["import React, { PropTypes } from 'react'\nimport ReactDOM from 'react-dom'\n\nimport CodeMirror from 'codemirror'\nimport 'codemirror/lib/codemirror.css'\nimport 'codemirror/mode/markdown/markdown'\n\nimport 'github-markdown-css'\nimport marked from 'marked'\nimport _ from 'lodash'\n\nimport ToolBar from './Toolbar'\nimport ControlBar from './ControlBar'\n\nconst styles = {\n  mkeditor: {\n    position: 'relative',\n    width: '100%',\n  },\n  navbar: {\n    position: 'absolute',\n    width: '100%',\n    background: '#f5f5f5',\n    border: '1px solid rgba(0,0,0,.06)',\n    borderTopLeftRadius: '4px',\n    borderTopRightRadius: '4px',\n    height: '40px',\n    overflow: 'hidden',\n  },\n  content: {\n    position: 'absolute',\n    top: '40px',\n    bottom: 0,\n    width: '100%',\n    borderLeft: '1px solid #ddd',\n    borderRight: '1px solid #ddd',\n    borderBottom: '1px solid #ddd',\n    background: '#fff',\n    borderBottomLeftRadius: '4px',\n    borderBottomRightRadius: '4px',\n  },\n  code: {\n    height: '100%',\n    overflowY: 'scroll',\n  },\n  preview: {\n    padding: '20px',\n    overflowY: 'scroll',\n    position: 'relative',\n  },\n  hide: {\n    display: 'none',\n  },\n  fullscreen: {\n    position: 'fixed',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    zIndex: 990,\n    height: '100%',\n  },\n}\n\nconst splitStyles = {\n  content: {\n    display: 'flex',\n  },\n  code: {\n    flex: 1,\n    borderRight: '1px solid #ddd',\n  },\n  preview: {\n    flex: 1,\n  },\n}\n\nclass MDEditor extends React.Component {\n  state = {\n    active: 'code',\n    html: '',\n    fullscreen: false,\n  }\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.md !== this.props.md) {\n      this.codeMirror.setValue(nextProps.md)\n    }\n  }\n  componentDidMount() {\n    this.codeMirror = CodeMirror.fromTextArea(ReactDOM.findDOMNode(this.refs.codemirror),\n    this.props.codemirror)\n    this.codeMirror.on('change', this.onChange)\n    this.codeParent = ReactDOM.findDOMNode(this.refs.codeParent)\n    this.resize()\n  }\n  componentDidUpdate(prevProps, prevState) {\n    const { fullscreen, mode } = this.state\n    if (prevState.fullscreen !== fullscreen || prevState.mode !== mode) {\n      this.resize()\n    }\n  }\n  onChange = () => {\n    if (this.props.mode === 'split') {\n      this.setState({\n        html: marked(this.codeMirror.getValue()),\n      })\n    }\n    if (onChange) {\n      onChange(this.codeMirror.getValue())\n    }\n  }\n  onActiveChange = (active) => {\n    if (active === 'code') {\n      this.setState({\n        active: 'code',\n      })\n    } else if (active === 'preview') {\n      this.setState({\n        active: 'preview',\n        html: marked(this.codeMirror.getValue()),\n      })\n    }\n  }\n  onFullScreenChange = () => {\n    this.setState({\n      fullscreen: !this.state.fullscreen,\n    })\n  }\n  addImage = (imageUrl) => {\n    const cm = this.codeMirror\n    const startPoint = cm.getCursor('start')\n    const endPoint = cm.getCursor('end')\n    cm.replaceSelection(`${cm.getSelection()}![](${imageUrl})`)\n    startPoint.ch = endPoint.ch\n    endPoint.ch += imageUrl.length + 5\n    cm.setSelection(startPoint, endPoint)\n    cm.focus()\n  }\n  resize = () => {\n    this.codeParent.lastChild.style.height = `${this.codeParent.offsetHeight}px`\n  }\n  render() {\n    const { md, height, mode, zIndex } = this.props\n    const { active, html, fullscreen } = this.state\n\n    const mkeditorStyles = _.merge({}, styles.mkeditor, { height: `${height}px` })\n    if (fullscreen) {\n      _.merge(mkeditorStyles, styles.fullscreen, { zIndex })\n    }\n    const contentStyles = _.merge({}, styles.content)\n    const codeStyles = _.merge({}, styles.code)\n    const previewStyles = _.merge({}, styles.preview)\n\n    if (mode === 'tab') {\n      if (active !== 'code') {\n        _.merge(codeStyles, styles.hide)\n      }\n      if (active !== 'preview') {\n        _.merge(previewStyles, styles.hide)\n      }\n    } else if (mode === 'split') {\n      _.merge(contentStyles, splitStyles.content)\n      _.merge(codeStyles, splitStyles.code)\n      _.merge(previewStyles, splitStyles.preview)\n    }\n    return (\n      <div style={mkeditorStyles}>\n        <div style={styles.navbar}>\n          <ToolBar getCM={() => this.codeMirror} />\n          <ControlBar\n            mode={mode}\n            active={active}\n            onActiveChange={this.onActiveChange}\n            fullscreen={fullscreen}\n            onFullScreenChange={this.onFullScreenChange}\n          />\n        </div>\n        <div style={contentStyles}>\n          <div ref=\"codeParent\" style={codeStyles}>\n            <textarea\n              ref=\"codemirror\"\n              style={{ display: 'none' }}\n              value={md}\n            />\n          </div>\n          <div\n            style={previewStyles}\n            className=\"markdown-body\"\n            dangerouslySetInnerHTML={{ __html: html }}\n          />\n        </div>\n      </div>\n    )\n  }\n}\n\nMDEditor.defaultProps = {\n  md: '',\n  height: 500,\n  mode: 'split',\n  zIndex: 1200,\n  codemirror: {\n    mode: 'markdown',\n    lineNumbers: false,\n    indentWithTabs: true,\n    lineWrapping: true,\n    tabSize: '2',\n  },\n}\nMDEditor.propTypes = {\n  md: PropTypes.string,\n  height: PropTypes.number,\n  mode: PropTypes.oneOf(['tab', 'split']),\n  zIndex: PropTypes.number,\n  codemirror: PropTypes.object,\n  onChange: PropTypes.func,\n}\nexport default MDEditor\n"]}